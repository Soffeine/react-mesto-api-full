(this["webpackJsonpmesto-react"]=this["webpackJsonpmesto-react"]||[]).push([[0],{29:function(e,t,n){},36:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),o=n(18),i=n.n(o),s=(n(29),n(23)),r=n(10),u=n(2),l=n.p+"static/media/add__button.eef2e85c.svg",p=n.p+"static/media/header-logo.b430ba41.svg",j=n(8),d=n(0);var m=function(e){var t=e.email,n=e.linkName,a=e.link,c=e.onSignOut;return Object(d.jsxs)("header",{className:"header",children:[Object(d.jsx)("img",{src:p,className:"header__logo",alt:"\u041b\u043e\u0433\u043e\u0442\u0438\u043f \u041c\u0435\u0441\u0442\u043e"}),Object(d.jsxs)("div",{className:"header__links-container",children:[Object(d.jsx)("p",{className:"header__link",children:t}),Object(d.jsx)(j.b,{to:a,className:"header__link",onClick:c,children:n})]})]})},b=c.a.createContext();var h=function(e){var t=e.card,n=e.onCardClick,c=e.onCardLike,o=e.onCardDelete,i=t.name,s=t.link,r=t.likes,u=Object(a.useContext)(b),l=t.owner===u._id,p="place__delete-button ".concat(l?"":"place__delete-button_hidden"),j=t.likes.some((function(e){return e===u._id})),m="place__like-button ".concat(j?"place__like-button_active":"");return Object(d.jsxs)("div",{className:"place",children:[Object(d.jsx)("img",{className:"place__image",src:s,alt:i,onClick:function(){return n(t)}}),Object(d.jsx)("button",{type:"button",className:p,onClick:function(){return o(t)}}),Object(d.jsxs)("div",{className:"place__caption",children:[Object(d.jsx)("h2",{className:"place__title",children:i}),Object(d.jsxs)("div",{className:"place__like-status-container",children:[Object(d.jsx)("button",{type:"button",className:m,onClick:function(){return c(t)}}),Object(d.jsx)("p",{className:"place__like-counter",children:r.length})]})]})]})};var f=function(e){var t=e.onEditProfileClick,n=e.onAddPlaceClick,c=e.onAvatarClick,o=e.onCardClick,i=e.cards,s=e.onCardLike,r=e.onCardDelete,u=e.userEmail,p=e.onSignOut,j=Object(a.useContext)(b);return Object(d.jsxs)("main",{children:[Object(d.jsx)(m,{link:"/signin",linkName:"\u0412\u044b\u0439\u0442\u0438",email:u,onSignOut:p}),Object(d.jsxs)("section",{className:"profile",children:[Object(d.jsxs)("div",{className:"profile__image",children:[Object(d.jsx)("img",{src:j.avatar,className:"profile__photo",id:"userAvatar",alt:"\u0424\u043e\u0442\u043e \u043f\u0440\u043e\u0444\u0438\u043b\u044f"}),Object(d.jsx)("button",{type:"button",className:"profile__edit-sign",onClick:c})]}),Object(d.jsxs)("div",{className:"profile__info",children:[Object(d.jsx)("h1",{className:"profile__name",id:"name",children:j.name}),Object(d.jsx)("button",{type:"button",className:"profile__edit-button",onClick:t}),Object(d.jsx)("p",{className:"profile__description",id:"description",children:j.about})]}),Object(d.jsx)("button",{type:"button",className:"profile__add-button",onClick:n,children:Object(d.jsx)("img",{src:l,alt:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0444\u043e\u0442\u043e"})})]}),Object(d.jsx)("section",{className:"places",children:i.map((function(e){return Object(d.jsx)(h,{card:e,onCardClick:o,cards:i,onCardLike:s,onCardDelete:r},e._id)}))})]})};var O=function(){return Object(d.jsx)("footer",{className:"footer",children:Object(d.jsx)("p",{className:"footer__copyright",children:"\xa9 2021 Mesto Russia"})})};var _=function(e){var t=e.email,n=e.password,a=e.title,c=e.buttonText,o=e.children,i=e.onChangeEmail,s=e.onChangePassword,r=e.onSubmit;return Object(d.jsxs)("form",{className:"auth-form",onSubmit:r,children:[Object(d.jsxs)("div",{className:"auth-form__container",children:[Object(d.jsx)("h2",{className:"auth-form__title",children:a}),Object(d.jsx)("input",{className:"auth-form__input",type:"email",placeholder:"Email",id:"email",name:"email",value:t||"",onChange:i,required:!0}),Object(d.jsx)("span",{className:"auth-form__span"}),Object(d.jsx)("input",{className:"auth-form__input",type:"password",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",id:"password",name:"password",value:n||"",onChange:s,required:!0}),Object(d.jsx)("span",{className:"auth-form__span"}),Object(d.jsx)("button",{className:"auth-form__submit",type:"submit",children:c})]}),o]})};var g=function(e){var t=e.onRegister,n=Object(a.useState)(""),c=Object(u.a)(n,2),o=c[0],i=c[1],s=Object(a.useState)(""),r=Object(u.a)(s,2),l=r[0],p=r[1];return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(m,{link:"/signin",linkName:"\u0412\u043e\u0439\u0442\u0438",email:""}),Object(d.jsx)(_,{email:o,password:l,title:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f",buttonText:"\u0417\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f",onChangeEmail:function(e){i(e.target.value)},onChangePassword:function(e){p(e.target.value)},onSubmit:function(e){e.preventDefault(),t(l,o)},children:Object(d.jsxs)("p",{className:"auth-form__signin",children:["\u0423\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b? ",Object(d.jsx)(j.b,{to:"/signin",className:"auth-form__signin_link",children:"\u0412\u043e\u0439\u0442\u0438"})]})})]})};var x=function(e){var t=e.onLogin,n=Object(a.useState)(""),c=Object(u.a)(n,2),o=c[0],i=c[1],s=Object(a.useState)(""),r=Object(u.a)(s,2),l=r[0],p=r[1];return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(m,{link:"/signup",linkName:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f",email:""}),Object(d.jsx)(_,{password:l,email:o,title:"\u0412\u0445\u043e\u0434",buttonText:"\u0412\u043e\u0439\u0442\u0438",onChangeEmail:function(e){i(e.target.value)},onChangePassword:function(e){p(e.target.value)},onSubmit:function(e){e.preventDefault(),t(l,o)}})]})};var v=function(e){var t=e.card,n=e.isOpened,a=e.popupName,c=e.onClose,o=t.link,i=t.name;return Object(d.jsx)("div",{className:n?"popup popup_opened popup-".concat(a):"popup popup-".concat(a),children:Object(d.jsxs)("div",{className:"popup-image__container",children:[Object(d.jsx)("button",{type:"button",className:"popup__close-button popup-image__close-button",onClick:c}),Object(d.jsx)("img",{className:"popup-image__picture",src:o.toString(),alt:"\u0444\u043e\u0442\u043e \u043c\u0435\u0441\u0442\u0430"}),Object(d.jsx)("p",{className:"popup-image__caption",children:i})]})})};var C=function(e){var t=e.name,n=e.title,a=e.children,c=e.buttonText,o=e.isOpened,i=e.onClose,s=e.onSubmit;return Object(d.jsx)("div",{className:o?"popup popup_opened popup-".concat(t):"popup popup-".concat(t),children:Object(d.jsxs)("div",{className:"popup__container",children:[Object(d.jsx)("button",{type:"button",className:"popup__close-button popup-edit__close-button",onClick:i}),Object(d.jsxs)("form",{className:"popup-form",name:t,id:"popup-".concat(t,"-form"),onSubmit:s,children:[Object(d.jsx)("h2",{className:"popup-form__heading",children:n}),a,Object(d.jsx)("button",{type:"submit",className:"popup__button popup__button_valid",name:"addSubmit",children:c})]})]})})};var N=function(e){var t=e.isOpen,n=e.onClose,c=e.onUpdateUser,o=Object(a.useContext)(b),i=Object(a.useState)(""),s=Object(u.a)(i,2),r=s[0],l=s[1],p=Object(a.useState)(""),j=Object(u.a)(p,2),m=j[0],h=j[1];return Object(a.useEffect)((function(){l(o.name),h(o.about)}),[o,t]),Object(a.useEffect)((function(){l(""),h("")}),[]),Object(d.jsxs)(C,{name:"edit",title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",buttonText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",isOpened:t,onClose:n,onSubmit:function(e){e.preventDefault(),c({name:r,about:m})},children:[Object(d.jsx)("input",{type:"text",value:r,onChange:function(e){l(e.target.value)},className:"popup-form__information popup-form__information_input_name",placeholder:"\u0418\u043c\u044f",name:"name",minLength:"2",maxLength:"20",required:!0}),Object(d.jsx)("span",{className:"popup__error-message"}),Object(d.jsx)("input",{type:"text",value:m,onChange:function(e){h(e.target.value)},className:"popup-form__information popup-form__information_input_description",placeholder:"\u0427\u0435\u043c \u0432\u044b \u0437\u0430\u043d\u0438\u043c\u0430\u0435\u0442\u0435\u0441\u044c?",name:"about",minLength:"2",maxLength:"200",required:!0}),Object(d.jsx)("span",{className:"popup__error-message"})]})};var k=function(e){var t=e.isOpen,n=e.onClose,c=e.onAddPlace,o=Object(a.useState)(""),i=Object(u.a)(o,2),s=i[0],r=i[1],l=Object(a.useState)(""),p=Object(u.a)(l,2),j=p[0],m=p[1];return Object(d.jsxs)(C,{name:"add",title:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",buttonText:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c",isOpened:t,onClose:n,onSubmit:function(e){e.preventDefault(),c({name:s,link:j}),r(""),m("")},children:[Object(d.jsx)("input",{type:"text",onChange:function(e){r(e.target.value)},className:"popup-form__information popup-form__information_input_place-name",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",value:s||"",name:"name",minLength:"2",maxLength:"30",required:!0}),Object(d.jsx)("span",{className:"popup__error-message"}),Object(d.jsx)("input",{onChange:function(e){m(e.target.value)},value:j||"",className:"popup-form__information popup-form__information_input_link-image",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",name:"link",type:"url",required:!0}),Object(d.jsx)("span",{className:"popup__error-message"})]})};var S=function(e){var t=e.isOpen,n=e.onClose,c=e.onUpdateAvatar,o=Object(a.useRef)(null);return Object(d.jsxs)(C,{name:"avatar",title:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",buttonText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",isOpened:t,onClose:n,onSubmit:function(e){e.preventDefault(),c({avatar:o.current.value})},children:[Object(d.jsx)("input",{ref:o,className:"popup-form__information popup-form__information_input_avatar-link",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0444\u043e\u0442\u043e",name:"avatar",type:"url",required:!0}),Object(d.jsx)("span",{className:"popup__error-message"})]})},y=n(21),T=n(22),P=new(function(){function e(t){Object(y.a)(this,e),this._url=t.url}return Object(T.a)(e,[{key:"_getResponseData",value:function(e){return e.ok?e.json():Promise.reject("\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 ".concat(e.status))}},{key:"getUserInfo",value:function(e){return fetch("".concat(this._url,"/users/me"),{method:"GET",headers:{authorization:"Bearer ".concat(e),"Content-Type":"application/json"},credentials:"include"}).then(this._getResponseData)}},{key:"getPlaceInfo",value:function(e){return fetch("".concat(this._url,"/cards"),{method:"GET",headers:{authorization:"Bearer ".concat(e),"Content-Type":"application/json"},credentials:"include"}).then(this._getResponseData)}},{key:"editProfileInfo",value:function(e,t){return fetch("".concat(this._url,"/users/me"),{method:"PATCH",headers:{authorization:"Bearer ".concat(t),"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:e.name,about:e.about})}).then(this._getResponseData)}},{key:"editAvatar",value:function(e,t){return fetch("".concat(this._url,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"Bearer ".concat(t),"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({avatar:e.avatar})}).then(this._getResponseData)}},{key:"addNewCard",value:function(e,t){return fetch("".concat(this._url,"/cards"),{method:"POST",headers:{authorization:"Bearer ".concat(t),"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:e.name,link:e.link})}).then(this._getResponseData)}},{key:"deleteCard",value:function(e,t){return fetch("".concat(this._url,"/cards/").concat(e),{method:"DELETE",headers:{authorization:"Bearer ".concat(t),"Content-Type":"application/json"},credentials:"include"}).then(this._getResponseData)}},{key:"changeLikeStatus",value:function(e,t,n){return fetch("".concat(this._url,"/cards/likes/").concat(e),{method:t?"PUT":"DELETE",headers:{authorization:"Bearer ".concat(n),"Content-Type":"application/json"},credentials:"include"}).then(this._getResponseData)}}]),e}())({url:"https://api.mesto.soffeine.nomoredomains.rocks"}),w=n(3),E=n(24),I=["component"],D=function(e){var t=e.component,n=Object(E.a)(e,I);return Object(d.jsx)(w.b,{children:function(){return n.loggedIn?Object(d.jsx)(t,Object(r.a)({},n)):Object(d.jsx)(w.a,{to:"./signin"})}})};var L=function(e){var t=e.data,n=e.isOpen,a=e.onClose;return Object(d.jsx)("div",{className:n?"popup popup_opened ":"popup",children:Object(d.jsxs)("div",{className:"popup__container",children:[Object(d.jsx)("button",{type:"button",className:"popup__close-button popup-edit__close-button",onClick:a}),Object(d.jsx)("img",{className:"popup__image",src:t.image,alt:"\u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438"}),Object(d.jsx)("p",{className:"popup__text",children:t.text})]})})},A="https://api.mesto.soffeine.nomoredomains.rocks",R=function(e){return e.ok?e.json():Promise.reject(e.status)},B=n.p+"static/media/onRegisterError.064903fa.svg",U=n.p+"static/media/onRegisterSuccess.bd528945.svg";var z=function(){var e=Object(a.useState)(!1),t=Object(u.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)(!1),i=Object(u.a)(o,2),l=i[0],p=i[1],j=Object(a.useState)(!1),m=Object(u.a)(j,2),h=m[0],_=m[1],C=Object(a.useState)({isImagePopupOpen:!1,selectedCard:""}),y=Object(u.a)(C,2),T=y[0],E=y[1],I=Object(a.useState)({}),z=Object(u.a)(I,2),q=z[0],J=z[1],F=Object(a.useState)([]),G=Object(u.a)(F,2),H=G[0],M=G[1],K=Object(a.useState)(!1),Q=Object(u.a)(K,2),V=Q[0],W=Q[1],X=Object(w.g)(),Y=Object(a.useState)(!1),Z=Object(u.a)(Y,2),$=Z[0],ee=Z[1],te=Object(a.useState)({}),ne=Object(u.a)(te,2),ae=ne[0],ce=ne[1],oe=Object(a.useState)(""),ie=Object(u.a)(oe,2),se=ie[0],re=ie[1],ue={image:B,text:"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437."},le={image:U,text:"\u0412\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c!"};function pe(e){ee(!0),ce(e)}function je(){c(!1),_(!1),p(!1),E((function(e){return Object(r.a)(Object(r.a)({},e),{},{isImagePopupOpen:!1})})),ee(!1)}var de=function(e){return function(e){return fetch("".concat(A,"/users/me"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},credentials:"include"}).then(R)}(e).then((function(e){var t=e.data;W(!0),re(t.email)})).catch((function(e){console.log(e)}))};return Object(a.useEffect)((function(){var e=localStorage.getItem("jwt");e&&de(e)}),[V]),Object(a.useEffect)((function(){V&&X.push("/")}),[V,X]),Object(a.useEffect)((function(){if(V){var e=localStorage.getItem("jwt");Promise.all([P.getUserInfo(e),P.getPlaceInfo(e)]).then((function(e){var t=Object(u.a)(e,2),n=t[0],a=t[1];J(n),M(a)})).catch((function(e){return console.log("\u0423\u043f\u0441, \u043e\u0448\u0438\u0431\u043e\u0447\u043a\u0430 ".concat(e))}))}}),[V]),Object(d.jsx)(b.Provider,{value:q,children:Object(d.jsxs)("div",{className:"page",children:[Object(d.jsxs)(w.d,{children:[Object(d.jsx)(D,{exact:!0,path:"/",loggedIn:V,component:f,onEditProfileClick:function(){c(!0)},onAddPlaceClick:function(){p(!0)},onAvatarClick:function(){_(!0)},onCardClick:function(e){E((function(t){return Object(r.a)(Object(r.a)({},t),{},{isImagePopupOpen:!0,selectedCard:e})}))},cards:H,onCardLike:function(e){var t=e.likes.some((function(e){return e===q._id})),n=localStorage.getItem("jwt");P.changeLikeStatus(e._id,!t,n).then((function(t){M((function(n){return n.map((function(n){return n._id===e._id?t:n}))}))})).catch((function(e){console.log(e)}))},onCardDelete:function(e){var t=localStorage.getItem("jwt");P.deleteCard(e._id,t).then((function(){M((function(){return H.filter((function(t){return t._id!==e._id}))}))})).catch((function(e){console.log(e)}))},userEmail:se,onSignOut:function(){W(!1),localStorage.removeItem("jwt")}}),Object(d.jsx)(w.b,{path:"/signup",children:Object(d.jsx)(g,{onRegister:function(e,t){(function(e,t){return fetch("".concat(A,"/signup"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:e,email:t})}).then(R)})(e,t).then((function(){pe(le),X.push("/signin")})).catch((function(e){pe(ue),console.log(e)}))}})}),Object(d.jsx)(w.b,{path:"/signin",children:Object(d.jsx)(x,{onLogin:function(e,t){return function(e,t){return fetch("".concat(A,"/signin"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:e,email:t})}).then(R).then((function(e){console.log(e),localStorage.setItem("jwt",e.token)}))}(e,t).then((function(){W(!0),X.push("/")})).catch((function(){pe(ue)}))}})})]}),Object(d.jsx)(O,{}),Object(d.jsx)(N,{isOpen:n,onClose:je,onUpdateUser:function(e){var t=localStorage.getItem("jwt");P.editProfileInfo(e,t).then((function(e){J(e),je()})).catch((function(e){console.log(e)}))}}),Object(d.jsx)(k,{isOpen:l,onClose:je,onAddPlace:function(e){var t=localStorage.getItem("jwt");P.addNewCard(e,t).then((function(e){M([e].concat(Object(s.a)(H))),je()})).catch((function(e){console.log(e)}))}}),Object(d.jsx)(S,{isOpen:h,onClose:je,onUpdateAvatar:function(e){var t=localStorage.getItem("jwt");P.editAvatar(e,t).then((function(e){J(e),je()})).catch((function(e){console.log(e)}))}}),Object(d.jsx)(v,{card:T.selectedCard,isOpened:T.isImagePopupOpen,popupName:"image",onClose:je}),Object(d.jsx)(L,{data:ae,isOpen:$,onClose:je})]})})},q=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,37)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,o=t.getLCP,i=t.getTTFB;n(e),a(e),c(e),o(e),i(e)}))};i.a.render(Object(d.jsx)(c.a.StrictMode,{children:Object(d.jsx)(j.a,{children:Object(d.jsx)(z,{})})}),document.getElementById("root")),q()}},[[36,1,2]]]);
//# sourceMappingURL=main.527fdbb6.chunk.js.map